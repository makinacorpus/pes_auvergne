
============
Installation
============
# Basée sur https://github.com/credis/django-coop/wiki/Installation

sudo apt-get install python-virtualenv git mercurial libpq-dev \
                     libmysqlclient-dev python-dev geoip-bin

cd ~/projects/pes_auvergne
virtualenv --no-site-packages .
export DJANGO_COOP_IONYWEB_PROJECT=`pwd`
source $DJANGO_COOP_IONYWEB_PROJECT/bin/activate

pip install django==1.4.5
pip install django-selectable 
pip install -e git+git://github.com/makinacorpus/django-coop@django-coop-ionyweb#egg=django-coop
pip install -U distribute
pip install -e git+git://github.com/makinacorpus/ionyweb#egg=ionyweb
pip install simplejson
pip install django-multisite

pip install -e git+git://github.com/makinacorpus/coop-geo@master#egg=coop-geo


# Modif en cours -------
pip uninstall django-admintools-bootstrap
pip install -e git+git://github.com/makinacorpus/django-admintools-bootstrap#egg=django-admintools-bootstrap

pip uninstall django-selectable
pip install -e git+git://github.com/makinacorpus/django-selectable.git@master#egg=django-selectable

pip uninstall django-chosen
pip install -e git+git://githubicone publier un article sur facebook.com/makinacorpus/django-chosen#egg=django-chosen
# ----------------------


cd $DJANGO_COOP_IONYWEB_PROJECT/
git clone gitorious-git@gitorious.makina-corpus.net:mes/pes_auvergne.git
cp pes_auvergne/coop_local/db_settings.py.sample pes_auvergne/coop_local/db_settings.py
cp pes_auvergne/coop_local/local_settings.py.sample pes_auvergne/coop_local/local_settings.py

# Plugins ionyweb/djangocoop
# --------------------------
cd $DJANGO_COOP_IONYWEB_PROJECT/pes_auvergne/pes_auvergne_ionyweb/
mkdir logs

cd $DJANGO_COOP_IONYWEB_PROJECT
pip install -r pes_auvergne/requirements.txt

# Créer la base de données
# Editer le fichier coop_local/local_settings.py
# Editer le fichier coop_local/db_settings.py

cd $DJANGO_COOP_IONYWEB_PROJECT/src/django-coop
git checkout origin/django-coop-ionyweb

cd $DJANGO_COOP_IONYWEB_PROJECT/pes_auvergne
sudo chmod -R g+rw media
chmod +x manage.py 
./manage.py collectstatic


python manage.py syncdb --all
python manage.py migrate --fake
python manage.py convert_to_south coop_local
./manage.py loaddata coop_local/fixtures/*


pip uninstall pil
pip install pillow


# For ionyweb 
pip uninstall django-tinymce
pip install django-tinymce==1.5.1b2

pip install urlobject
pip install django-filebrowser

python manage.py syncdb
python manage.py migrate


# Dans la table django_site, mettre à jour le nom de domaine
# Dans multisite_alias également

# Export/Import de données (pes_auvergne) :
# Note: il faut utiliser l'option --natural de dumpdata pour éviter
# l'incohérence des contenttypes et ajuster le chemin des medias
cd ~/projects/pes_auvergne/pes_auvergne
./manage.py loaddata ~/tmp/promess84_ionyweb.json

# Export/import des media:
# copier le répertoire media de ionyweb dans celui de django_coop


# Dans ~/projects/promess84/local/lib/python2.7/site-packages/ionyweb/plugin_app/plugin_slideshow/views.py
# Modifier ionyweb.slideshow.js en ionyweb_slideshow.js (bug ionyweb plugin sideshow)

# Corriger également tinymce

=====================================

Lancement :
-----------
cd ~/projects/pes_auvergne
export DJANGO_COOP_IONYWEB_PROJECT=`pwd`
source $DJANGO_COOP_IONYWEB_PROJECT/bin/activate
cd pes_auvergne
./manage.py runserver

